{% extends "base.html" %}
{% load socialaccount %}
{% load static %}

{% block title %}
<title>Dashboard - SIGAP-IT</title>
{% endblock title %}

{% block app_css %}
{% include "snippets/styles.html" %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock app_css %}

{% block content %}

{% block message %}
{% if messages %}
{% for message in messages %}
<div class="toast-notification">{{ message }}</div>
{% endfor %}
{% endif %}
{% endblock message %}

<div class="dashboard">

  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div>
      <h1>Dashboard</h1>
      <p class="subtitle">Welcome back, {{ user.first_name|default:"Admin" }}! Here's what's happening today</p>
    </div>
    <div class="header-actions">
      <button class="btn-secondary">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        Export
      </button>
      <a href="{% url 'ticket:create_ticket' %}" class="btn-primary">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        New Ticket
      </a>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card stat-primary">
      <div class="stat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M12 6v6l4 2"></path>
        </svg>
      </div>
      <div class="stat-info">
        <p class="stat-label">Open Tickets</p>
        <h2 class="stat-value" id="percentopen"></h2>
        <p class="stat-change positive">+12% from last month</p>
      </div>
    </div>

    <div class="stat-card stat-info">
      <div class="stat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </svg>
      </div>
      <div class="stat-info">
        <p class="stat-label">In Progress</p>
        <h2 class="stat-value" id="percentinprogress"></h2>
        <p class="stat-change neutral">No change</p>
      </div>
    </div>

    <div class="stat-card stat-success">
      <div class="stat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </div>
      <div class="stat-info">
        <p class="stat-label">Resolved</p>
        <h2 class="stat-value" id="percentclosed"></h2>
        <p class="stat-change positive">+8% from last month</p>
      </div>
    </div>

    <div class="stat-card stat-warning">
      <div class="stat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="9" y1="9" x2="15" y2="9"></line>
          <line x1="9" y1="15" x2="15" y2="15"></line>
        </svg>
      </div>
      <div class="stat-info">
        <p class="stat-label">Total Tickets</p>
        <h2 class="stat-value" id="total_count"></h2>
        <p class="stat-change neutral">This month</p>
      </div>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="dashboard-grid">

    <!-- Left Column -->
    <div class="dashboard-left">

      <!-- Chart Section -->
      <div class="widget chart-widget">
        <div class="widget-header">
          <h3>Ticket Status Overview</h3>
          <!--<select class="period-select">
            <option>Last 7 days</option>
            <option>Last 30 days</option>
            <option>Last 3 months</option>
          </select>-->
        </div>
        <div class="widget-body">
          <div class="chart-container">
            <div class="chart-box">
              <canvas id="statusChart" width="280" height="280"></canvas>
            </div>
            <div class="legend">
              <div class="legend-item">
                <span class="dot dot-warning"></span>
                <div class="legend-text">
                  <span class="legend-label">Open</span>
                  <span class="legend-value">{{ open_count|default:0 }} tickets</span>
                </div>
              </div>
              <div class="legend-item">
                <span class="dot dot-info"></span>
                <div class="legend-text">
                  <span class="legend-label">In Progress</span>
                  <span class="legend-value">{{ progress_count|default:0 }} tickets</span>
                </div>
              </div>
              <div class="legend-item">
                <span class="dot dot-success"></span>
                <div class="legend-text">
                  <span class="legend-label">Resolved</span>
                  <span class="legend-value">{{ closed_count|default:0 }} tickets</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Tickets Table -->
      <!--<div class="widget table-widget">
        <div class="widget-header">
          <h3>Recent Tickets</h3>
          <a href="{% url 'ticket:ticket_index' %}" class="view-all">View All â†’</a>
        </div>
        <div class="widget-body">
          <div class="table-responsive">
            <table class="dashboard-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Title</th>
                  <th>Status</th>
                  <th>Priority</th>
                  <th>Assigned</th>
                  <th>Date</th>
                </tr>
              </thead>
              <tbody>
                {% for ticket in recent_tickets %}
                <tr>
                  <td><span class="ticket-id">#{{ ticket.id_ticket }}</span></td>
                  <td class="ticket-title">{{ ticket.title|truncatewords:5 }}</td>
                  <td>
                    {% if ticket.status == 1 %}
                    <span class="badge badge-warning">Open</span>
                    {% elif ticket.status == 2 %}
                    <span class="badge badge-info">In Progress</span>
                    {% else %}
                    <span class="badge badge-success">Closed</span>
                    {% endif %}
                  </td>
                  <td><span class="badge badge-outline">Medium</span></td>
                  <td>{{ ticket.assigned_to|default:"Unassigned" }}</td>
                  <td class="text-muted">{{ ticket.created_at|date:"M d, Y" }}</td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="6" class="text-center text-muted">No tickets yet</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>-->


    </div>

    <!-- Right Column -->
    <div class="dashboard-right">

      <!-- Quick Actions -->
      <div class="widget quick-actions-widget">
        <div class="widget-header">
          <h3>Quick Actions</h3>
        </div>
        <div class="widget-body">
          <div class="quick-actions">
            <a href="{% url 'ticket:create_ticket' %}" class="quick-action">
              <div class="action-icon action-primary">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </div>
              <div class="action-text">
                <h4>Create Ticket</h4>
                <p>Submit new support request</p>
              </div>
            </a>
            <a href="{% url 'ticket:ticket_index' %}" class="quick-action">
              <div class="action-icon action-info">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="9" y1="9" x2="15" y2="9"></line>
                  <line x1="9" y1="15" x2="15" y2="15"></line>
                </svg>
              </div>
              <div class="action-text">
                <h4>View All Tickets</h4>
                <p>Browse all support tickets</p>
              </div>
            </a>
            <a href="{% url 'profile' %}" class="quick-action">
              <div class="action-icon action-success">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
              </div>
              <div class="action-text">
                <h4>My Profile</h4>
                <p>Update account settings</p>
              </div>
            </a>
          </div>
        </div>
      </div>

      <!-- Activity Timeline -->
      <!--<div class="widget activity-widget">
        <div class="widget-header">
          <h3>Recent Activity</h3>
        </div>
        <div class="widget-body">
          <div class="activity-timeline">
            <div class="activity-item">
              <div class="activity-icon activity-success">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
              </div>
              <div class="activity-content">
                <p class="activity-text"><strong>Ticket #0110202105</strong> was closed</p>
                <span class="activity-time">2 hours ago</span>
              </div>
            </div>
            <div class="activity-item">
              <div class="activity-icon activity-info">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
              </div>
              <div class="activity-content">
                <p class="activity-text"><strong>Ticket #0110202141</strong> in progress</p>
                <span class="activity-time">5 hours ago</span>
              </div>
            </div>
            <div class="activity-item">
              <div class="activity-icon activity-primary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </div>
              <div class="activity-content">
                <p class="activity-text">New ticket created by <strong>user1</strong></p>
                <span class="activity-time">1 day ago</span>
              </div>
            </div>
            <div class="activity-item">
              <div class="activity-icon activity-warning">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z">
                  </path>
                  <line x1="12" y1="9" x2="12" y2="13"></line>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
              </div>
              <div class="activity-content">
                <p class="activity-text">System maintenance scheduled</p>
                <span class="activity-time">2 days ago</span>
              </div>
            </div>
          </div>
        </div>
      </div>-->
    </div>
  </div>

</div>

{% block app_js %}
{% include "snippets/scripts.html" %}
{% endblock app_js %}
{% endblock content %}