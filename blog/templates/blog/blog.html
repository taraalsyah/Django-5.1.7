{% extends "base.html" %}
{% load static %}


{% block app_css %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static 'blog/css/styles.css' %}">
<script>
  function confirmDelete() {
    return confirm("Are you sure you want to delete this item?");
  }
</script>
{% endblock app_css %}


{% block header %}
<h1>{{heading}}</h1>
{% endblock header %}



{% block content %}
{% if messages %}
<div>
  {% for message in messages %}
  <div class="alert alert-{{ message.tags }} rounded p-2 mb-2">
    {{ message }}
  </div>
  {% endfor %}
</div>
{% endif %}



<p class="dashboard-blog">Ini dashboard BLOG contoh overloading 3 blog</p>
<h3 style="text-align: center;">Contoh Tabel HTML</h3>
<a href="{% url 'blog:download_posts_csv' %}?search={{ request.GET.search }}&category={{ request.GET.category }}">Download
  CSV</a>
<form method="GET" class="search-form">
  <input type="text" name="search" placeholder="Cari judul..." value="{{ search_query }}" class="search-input">
  <select name="category" class="search-select">
    <option value="">Semua Kategori</option>
    <option value="Jurnal" {% if category_filter == "Jurnal" %}selected{% endif %}>Jurnal</option>
    <option value="Berita" {% if category_filter == "Berita" %}selected{% endif %}>Berita</option>
    <option value="Blog" {% if category_filter == "Blog" %}selected{% endif %}>Blog</option>
  </select>
  <button type="submit" class="search-button">Cari</button>
</form>

<table class="post-table">
  <thead>
    <tr>
      <th>No</th>
      <th>Judul</th>
      <th>Body</th>
      <th>Slug</th>
      <th>Category</th>
      <th>Created At</th>
      <th>Updated At</th>
      <th>City</th>
      <th>Country</th>
      <th>Delete</th>
      <th>Update</th>
    </tr>
  </thead>
  <tbody>
    {% for post in page_obj %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td><a href="/blog/{{ post.slug }}/">{{ post.title }}</a></td>
      <td>{{ post.body|truncatechars:lengthchars }}</td>
      <td>{{ post.slug }}</td>
      <td>{{ post.category }}</td>
      <td>{{ post.created_at }}</td>
      <td>{{ post.updated_at }}</td>
      <td>{{ post.city}}</td>
      <td>{{ post.country }}</td>
      <td>
        <form action="{% url 'blog:delete' post.id %}" method="POST" class="form-delete"
          onsubmit="return confirmDelete();">
          {% csrf_token %}
          <button type="submit" class="btn btn-delete">Delete</button>
        </form>
      </td>
      <td>
        <form action="{% url 'blog:update' post.id %}" method="GET" class="form-update">
          {% csrf_token %}
          <button type="submit" class="btn btn-update">Update</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>



<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    {% if page_obj.has_previous %}
    <li class="page-item">
      <a class="page-link" href="?search={{ search_query }}&category={{ category_filter }}&page=1" aria-label="First">
        <span aria-hidden="true">&laquo; First</span>
      </a>
    </li>
    <li class="page-item">
      <a class="page-link"
        href="?search={{ search_query }}&category={{ category_filter }}&page={{ page_obj.previous_page_number }}">
        Previous
      </a>
    </li>
    {% endif %}

    <li class="page-item disabled">
      <span class="page-link">
        Halaman {{ page_obj.number }} dari {{ page_obj.paginator.num_pages }}
      </span>
    </li>

    {% if page_obj.has_next %}
    <li class="page-item">
      <a class="page-link"
        href="?search={{ search_query }}&category={{ category_filter }}&page={{ page_obj.next_page_number }}">
        Next
      </a>
    </li>
    <li class="page-item">
      <a class="page-link"
        href="?search={{ search_query }}&category={{ category_filter }}&page={{ page_obj.paginator.num_pages }}"
        aria-label="Last">
        <span aria-hidden="true">Last &raquo;</span>
      </a>
    </li>
    {% endif %}
  </ul>
</nav>


{% endblock content %}